<app-resize-vertical-splitter side="left"
							  (dx)="resize.emit($event)"
							  [minX]="250"
							  [maxX]="maxResizeMovingX">
</app-resize-vertical-splitter>
<app-toolbar title="Projects" [borderRight]="true">
	<ng-container left-side *ngIf="activeProject$ | async as project">
		<mat-icon [matMenuTriggerFor]="projectMenu"
				  appTooltip tooltip="Show projects"
				  class="project-list-icon">arrow_drop_down</mat-icon>
		<mat-menu #projectMenu="matMenu" classList="dropdown-list" xPosition="before">
			<button mat-menu-item *ngFor="let project of (projectsList$ | async) || []" (click)="openProject(project.id)">
				<mat-icon>folder</mat-icon>
				<span>{{project.name}} [{{project.chainId | networkName | async}}]</span>
			</button>
		</mat-menu>
	</ng-container>

	<ng-container right-side *ngIf="activeProject$ | async as project">
		<app-toolbar-icon-button  appTooltip tooltip="Select opened element" (click)="showCurrentTab(project.id)">
			my_location
		</app-toolbar-icon-button>
		<app-toolbar-icon-button appTooltip tooltip="Create" (click)="createProject()">
			add
		</app-toolbar-icon-button>
		<app-toolbar-icon-button appTooltip tooltip="Refresh" (click)="loadProjects()">
			refresh
		</app-toolbar-icon-button>
	</ng-container>
</app-toolbar>

<div class="project-explorer">
	<ng-container *ngIf="activeProject$ | async as project; else projectSelectList">
		<app-project-element [isExpanded]="projectExplorerState.project"
							 [bold]="true"
							 [expandable]="true"
							 [name]="project.name"
							 (onExpand)="onExpandElement(project.id, 'project', $event)">
			<div actions class="project-network">
				{{(project.chainId | networkName | async)}}
			</div>

			<div innerElements>
				<app-project-element [expandable]="true"
									 [isExpanded]="projectExplorerState.abi"
									 (onExpand)="onExpandElement(project.id,'abi', $event)"
									 name="ABI interfaces">
					<ng-container innerElements>
						<app-project-element #abiElem
											 (click)="openProjectComponent(abi.name, 'abi', abi.id)"
											 *ngFor="let abi of project.abiInterfaces; trackBy: abiTrackBy"
											 [isExpanded]="projectExplorerState.abi"
											 (onExpand)="onExpandElement(project.id, 'abi', $event)"
											 (onActivate)="onActivateElement(abiElem)"
											 type="abi"
											 [active]="(abi.id | isActiveProjectElement: project.id : 'abi') | async"
											 [name]="abi.name || abi.name">
							<ng-container actions>
								<div class="tip-label">{{abi.content.buildInfo?.framework?.name}}</div>
								<button mat-icon-button [matMenuTriggerFor]="abiMenu" (click)="$event.stopImmediatePropagation()">
									<mat-icon class="dropdown-icon">more_vert</mat-icon>
								</button>
								<mat-menu #abiMenu="matMenu" classList="dropdown-list" xPosition="before">
									<button mat-menu-item (click)="renameAbi(project.id, abi.id, abi.name)">
										<mat-icon>drive_file_rename_outline</mat-icon>
										<span>Rename</span>
									</button>
									<button mat-menu-item (click)="deleteAbi(project.id, abi.id)">
										<mat-icon>delete</mat-icon>
										<span>Delete</span>
									</button>
								</mat-menu>
							</ng-container>
						</app-project-element>
					</ng-container>
				</app-project-element>
				<app-project-element [expandable]="true"
									 [isExpanded]="projectExplorerState.sc"
									 (onExpand)="onExpandElement(project.id,'sc', $event)"
									 name="Smart contracts">
					<ng-container innerElements>
						<app-project-element #scElem
											 (click)="openProjectComponent(sc.name, 'sc', sc.id)"
											 *ngFor="let sc of project.smartContracts; trackBy: scTrackBy"
											 type="sc"
											 [active]="(sc.id | isActiveProjectElement: project.id : 'sc') | async"
											 [isExpanded]="projectExplorerState.sc"
											 (onExpand)="onExpandElement(project.id, 'sc', $event)"
											 (onActivate)="onActivateElement(scElem)"
											 [name]="sc.name || sc.name">
							<ng-container actions>
								<div class="tip-label">{{sc.address | subString}}</div>
								<button mat-icon-button [matMenuTriggerFor]="scMenu" (click)="$event.stopImmediatePropagation()">
									<mat-icon class="dropdown-icon">more_vert</mat-icon>
								</button>
								<mat-menu #scMenu="matMenu" classList="dropdown-list" xPosition="before">
									<button mat-menu-item (click)="renameSmartContract(project.id, sc.id, sc.name)">
										<mat-icon>drive_file_rename_outline</mat-icon>
										<span>Rename</span>
									</button>
									<button mat-menu-item (click)="deleteSmartContract(project.id, sc.id)">
										<mat-icon>delete</mat-icon>
										<span>Delete</span>
									</button>
								</mat-menu>
							</ng-container>
						</app-project-element>
					</ng-container>
				</app-project-element>
				<app-project-element [expandable]="true"
									 [isExpanded]="projectExplorerState.token"
									 (onExpand)="onExpandElement(project.id, 'token', $event)"
									 type="group"
									 name="Tokens">
					<ng-container innerElements>
						<app-project-element #tokenElem *ngFor="let tokenAddress of project.tokens; trackBy: tokenTrackBy"
											 (click)="openProjectComponent(tokenAddress, 'token', tokenAddress)"
											 [isExpanded]="projectExplorerState.token"
											 (onExpand)="onExpandElement(project.id, 'token', $event)"
											 (onActivate)="onActivateElement(tokenElem)"
											 type="token"
											 [active]="(tokenAddress | isActiveProjectElement: project.id : 'token') | async"
											 [name]="tokenAddress">
							<ng-container actions>
								<div class="tip-label">ESDT</div>
								<button mat-icon-button [matMenuTriggerFor]="tokenMenu" (click)="$event.stopImmediatePropagation()">
									<mat-icon class="dropdown-icon">more_vert</mat-icon>
								</button>
								<mat-menu #tokenMenu="matMenu" classList="dropdown-list" xPosition="before">
									<button mat-menu-item (click)="exploreToken(project.id, tokenAddress)">
										<mat-icon>search</mat-icon>
										<span>Explore</span>
									</button>
									<button mat-menu-item (click)="deleteToken(project.id, tokenAddress)">
										<mat-icon>delete</mat-icon>
										<span>Delete</span>
									</button>
								</mat-menu>
							</ng-container>
						</app-project-element>
					</ng-container>
				</app-project-element>
				<app-project-element [expandable]="true"
									 [isExpanded]="projectExplorerState.nft"
									 (onExpand)="onExpandElement(project.id, 'nft', $event)"
									 type="group"
									 name="NFTs (coming soon)">
				</app-project-element>

				<app-project-element [expandable]="true"
									 [isExpanded]="projectExplorerState.wallet"
									 (onExpand)="onExpandElement(project.id, 'wallet', $event)"
									 type="group"
									 name="Wallets">
					<ng-container innerElements>
						<app-project-element #walletElem *ngFor="let wallet of project.wallets; trackBy: walletTrackBy"
											 (click)="openProjectComponent(wallet.name, 'wallet', wallet.address)"
											 [isExpanded]="projectExplorerState.wallet"
											 (onExpand)="onExpandElement(project.id, 'wallet', $event)"
											 (onActivate)="onActivateElement(walletElem)"
											 type="wallet"
											 [active]="(wallet.address | isActiveProjectElement: project.id : 'wallet') | async"
											 [name]="wallet.name">
							<ng-container actions>
								<div class="tip-label">{{wallet.address | subString}}</div>
								<button mat-icon-button [matMenuTriggerFor]="walletGroupMenu" (click)="$event.stopImmediatePropagation()">
									<mat-icon class="dropdown-icon">more_vert</mat-icon>
								</button>
								<mat-menu #walletGroupMenu="matMenu" classList="dropdown-list" xPosition="before">
									<button *ngIf="project.chainId | isNotMainnetNetwork"
											mat-menu-item
											(click)="faucet.gotoFaucet()">
										<mat-icon>monetization_on</mat-icon>
										<span>Open faucet</span>
									</button>
									<button mat-menu-item (click)="copyWalletAddress(wallet.address)">
										<mat-icon>content_copy</mat-icon>
										<span>Copy address</span>
									</button>
									<button mat-menu-item (click)="renameWallet(project.id, wallet.address, wallet.name)">
										<mat-icon>drive_file_rename_outline</mat-icon>
										<span>Rename</span>
									</button>
									<button mat-menu-item (click)="deleteWallet(project.id, wallet.address)">
										<mat-icon>delete</mat-icon>
										<span>Delete</span>
									</button>
								</mat-menu>
							</ng-container>
						</app-project-element>
					</ng-container>
				</app-project-element>
			</div>
		</app-project-element>
	</ng-container>
</div>


<ng-template #projectSelectList>
	<app-project-list [projects]="(projectsList$ | async) || []"
					  (create)="createProject()"
					  (open)="openProject($event)"></app-project-list>
</ng-template>
